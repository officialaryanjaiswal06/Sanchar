#spring.application.name=api-gateway
#server.port=8080
#
## --- EUREKA ---
#eureka.client.service-url.defaultZone=http://localhost:8761/eureka/
#spring.cloud.gateway.discovery.locator.enabled=true
#spring.cloud.gateway.discovery.locator.lower-case-service-id=true
#eureka.instance.prefer-ip-address=true
#eureka.instance.hostname=localhost
#
## --- SECURITY KEYS ---
#jwt.secret=5367566B59703373367639792F423F4528482B4D6251655468576D5A71347989
#gateway.secret=5367566B59703373367639792F423F4528482B4D6251655468576D5A71347889
#
## --- CORS CONFIGURATION ---
#spring.cloud.gateway.globalcors.cors-configurations.[/**].allowed-origin-patterns=*
#spring.cloud.gateway.globalcors.cors-configurations.[/**].allowed-methods=GET, POST, PUT, DELETE, OPTIONS
#spring.cloud.gateway.globalcors.cors-configurations.[/**].allowed-headers=*
#spring.cloud.gateway.globalcors.cors-configurations.[/**].allow-credentials=true
#
## ====================================================
## ROUTES CONFIGURATION
## Using "Authentication" filter (Spring maps this to AuthenticationGatewayFilterFactory)
## ====================================================
#
## Route 0: File Service
#spring.cloud.gateway.routes[0].id=file-service
#spring.cloud.gateway.routes[0].uri=lb://FILE-SERVICE
#spring.cloud.gateway.routes[0].predicates[0]=Path=/files/**
#spring.cloud.gateway.routes[0].filters[0]=Authentication
#
## Route 1: User Service
#spring.cloud.gateway.routes[1].id=user-service
#spring.cloud.gateway.routes[1].uri=lb://USER-SERVICE
#spring.cloud.gateway.routes[1].predicates[0]=Path=/auth/**,/users/**
#spring.cloud.gateway.routes[1].filters[0]=Authentication
#
## Route 2: Chat Service (API)
#spring.cloud.gateway.routes[2].id=chat-service-api
#spring.cloud.gateway.routes[2].uri=lb://CHAT-SERVICE
#spring.cloud.gateway.routes[2].predicates[0]=Path=/chat/**
#spring.cloud.gateway.routes[2].filters[0]=Authentication
#
## Route 3: Chat Service (WebSocket)
## No filter here because Handshake is Open (WebSocketInterceptor handles sec)
#spring.cloud.gateway.routes[3].id=chat-service-ws
#spring.cloud.gateway.routes[3].uri=lb:ws://CHAT-SERVICE
#spring.cloud.gateway.routes[3].predicates[0]=Path=/ws-chat/**


spring.application.name=api-gateway
server.port=8080

# --- EUREKA ---
eureka.client.service-url.defaultZone=http://localhost:8761/eureka/
spring.cloud.gateway.discovery.locator.enabled=true
# Since this is true, we must use lowercase URIs below
spring.cloud.gateway.discovery.locator.lower-case-service-id=true
eureka.instance.prefer-ip-address=true
eureka.instance.hostname=localhost

# --- SECURITY KEYS ---
jwt.secret=5367566B59703373367639792F423F4528482B4D6251655468576D5A71347989
gateway.secret=5367566B59703373367639792F423F4528482B4D6251655468576D5A71347889

# --- CORS CONFIGURATION ---
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowed-origin-patterns=*
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowed-methods=GET, POST, PUT, DELETE, OPTIONS
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowed-headers=*
spring.cloud.gateway.globalcors.cors-configurations.[/**].allow-credentials=true

# ====================================================
# ROUTES CONFIGURATION (Fixed Case Sensitivity)
# ====================================================

# Route 0: File Service
spring.cloud.gateway.routes[0].id=file-service
spring.cloud.gateway.routes[0].uri=lb://file-service  
# ^ CHANGED from FILE-SERVICE to file-service
spring.cloud.gateway.routes[0].predicates[0]=Path=/files/**
spring.cloud.gateway.routes[0].filters[0]=Authentication

# Route 1: User Service
spring.cloud.gateway.routes[1].id=user-service
spring.cloud.gateway.routes[1].uri=lb://user-service 
# ^ CHANGED from USER-SERVICE to user-service
spring.cloud.gateway.routes[1].predicates[0]=Path=/auth/**,/users/**,/friends/**
spring.cloud.gateway.routes[1].filters[0]=Authentication

# Route 2: Chat Service (API)
spring.cloud.gateway.routes[2].id=chat-service-api
spring.cloud.gateway.routes[2].uri=lb://chat-service
# ^ CHANGED from CHAT-SERVICE to chat-service
spring.cloud.gateway.routes[2].predicates[0]=Path=/chat/**
spring.cloud.gateway.routes[2].filters[0]=Authentication

# Route 3: Chat Service (WebSocket)
spring.cloud.gateway.routes[3].id=chat-service-ws
spring.cloud.gateway.routes[3].uri=lb:ws://chat-service
# ^ CHANGED to chat-service
spring.cloud.gateway.routes[3].predicates[0]=Path=/ws-chat/**

spring.cloud.gateway.routes[3].filters[0]=DedupeResponseHeader=Access-Control-Allow-Origin Access-Control-Allow-Credentials, RETAIN_FIRST